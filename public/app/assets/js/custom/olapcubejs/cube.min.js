!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.Cube=n()}(this,function(){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}function y(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function d(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.forEach(function(e){y(n,e,t[e])})}return n}function i(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&t(e,n)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function t(e,n){return(t=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function a(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],0<=n.indexOf(t)||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],0<=n.indexOf(t)||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?c(e):n}function m(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var e,p=function e(n,t){v(this,e),this.message="Can't add member, member for rollup dimension: ".concat(n," with id: ").concat(t," not found")},u=function e(n){v(this,e),this.message="In fact data, no property was found with the name: ".concat(n)},f=function e(n){v(this,e),this.message='For the name "'.concat(n,'" the dimension is already set')},h=console,b=function(e){h.warn("[Cube] ".concat(e))},g=(e={},function e(n){v(this,e);try{for(var t in n){if(!n.hasOwnProperty(t))return;r=n[t],void 0,"object"!==(i=o(r))&&"function"!==i&&"undefined"!==i||null===r?this[t]=n[t]:b('[Fact] value of prop "'.concat(t,'" has an unspecified value: ').concat(n[t]))}}catch(e){!function(e){throw e.message="[Cube] ".concat(e.message),e}(e)}var r,i}),T=function(e){function n(){return v(this,n),l(this,s(n).apply(this,arguments))}return i(n,g),n}();var E=function(e){function t(e,n){return v(this,t),e.id||(e.id=t.generateId()),l(this,s(t).call(this,e,n))}return i(t,T),n(t,null,[{key:"createEmptyCell",value:function(e){return new t(e)}},{key:"isEmptyCell",value:function(e){return"string"==typeof e.id}},{key:"generateId",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0;return("x"==e?n:3&n|8).toString(16)})}}]),t}(),O=function e(n){v(this,e),Object.assign(this,n)},D=function(e){function n(){return v(this,n),l(this,s(n).apply(this,arguments))}return i(n,O),n}(),k=function(){function k(){v(this,k)}return n(k,null,[{key:"anotherBuild",value:function(n,t,e,r,i){e.forEach(function(e){k.anotherBuildOne(e,t,r,n,i)})}},{key:"anotherBuildOne",value:function(e,t,r,i,o){e.tracePostOrder(function(e,n){k.processDimension(n,t,r,i,o)})}},{key:"processDimension",value:function(r,i,e,n,t){var o=r.getTreeValue(),a=o.dimension,u=o.keyProps,l=void 0===u?[]:u,s=o.otherProps,f=void 0===s?[]:s,c=o.members,h=o.foreignKey,m=o.primaryKey,y=r.getChildTrees().map(function(e){return e.getTreeValue().foreignKey}),v=r.getChildTrees().map(function(e){return e.getTreeValue().dimension}),d=[],p=c.length,b=[t,m,h,p,n,i,a,l,f,i,e];if(y.length){var g=[];y.forEach(function(u,s){var e=v[s],n=r.getDimensionTreeByDimension(e).getTreeValue(),t=n.members;g=k.mapFilter(u,i,t,n);var c=0;g.forEach(function(e){if(e.length){var n;if(0===s){var t=b.concat();t[5]=e,t.push(c);var r=k.createKeyIdMap.apply(null,t);n=k.createMembersDataByKeyIdMap(r,e,l,f,m,h)}else n=e.map(function(n){return d.find(function(e){return n[h]===e[m]})});c+=n.length;var i=e[0];if(n.forEach(function(e){e[u]=i[u]}),e.forEach(function(e){delete e[u]}),d.length)n.forEach(function(n){d.find(function(e){return e[m]===n[m]})||d.push(n)});else{var o=d.length,a=p+o;n.forEach(function(e,n){e[m]=a+n+1}),d=n}}})})}else{var T=k.createKeyIdMap.apply(null,b);d=k.createMembersDataByKeyIdMap(T,i,l,f,m,h)}function E(n,e,t){e.forEach(function(e){e!==t&&delete n[e]})}i.forEach(function(e){E(e,l,t),E(e,f,t)}),d.map(function(e){return new O(e)}).forEach(function(e){o.addMember(e)})}},{key:"mapFilter",value:function(t,r,e,i){var o=[];return e.forEach(function(n){var e=r.filter(function(e){return e[t]==i.getMemberPrimaryKey(n)});o.push(e)}),o}},{key:"createKeyIdMap",value:function(r,e,i,n,o,t,a){var u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:[],s=9<arguments.length?arguments[9]:void 0,c=10<arguments.length?arguments[10]:void 0,l=11<arguments.length&&void 0!==arguments[11]?arguments[11]:0,f={},h={};return c.filter(function(e){return-1===s.indexOf(e)}).forEach(function(n){var e=o.find(function(e){return e[r]===n[r]}),t=k.createKeyFromProps(u,e);t in h||(h[t]=++l)}),t.forEach(function(e){var n=k.createKeyFromProps(u,e);n in f||n in h||(f[n]=++l);var t=f[n];e[i]=t}),f}},{key:"createMembersDataByKeyIdMap",value:function(i,o,a,u,s,c){var l=[];return Object.keys(i).forEach(function(e){var n=i[e],t=o.find(function(e){return e[c]===n}),r=k.createMemberData(n,[].concat(a).concat(u),t,s);l.push(r)}),l}},{key:"createMemberData",value:function(e,n,t,r){var i={};return i[r]=e,n.forEach(function(e){e!==r&&(i[e]=t[e])}),i}},{key:"createInputMember",value:function(e,n,t,r){var i={};n.forEach(function(e){i[e]=t.hasOwnProperty(e)?t[e]:null});var o=k.createMemberData(e,n,i,r,D);return new D(o)}},{key:"createKeyFromProps",value:function(e,n){return e.map(function(e){return n[e]}).join(",")}},{key:"destroy",value:function(t,e,r,i){var o=this;e.forEach(function(e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}),e.forEach(function(n){r.forEach(function(e){k.travers([n],e,[k.removeMembers.bind(o,i,e),k.restoreCell])})})}},{key:"denormalize",value:function(e,t){var n=[];return e.forEach(function(e){n.push(d({},e))}),n.forEach(function(n){t.forEach(function(e){k.travers([n],e,[k.restoreCell])})}),n}},{key:"restoreCell",value:function(e,n,t,r,i,o){var a=new O(e);o.deleteMemberId(a),delete r[i],Object.assign(r,a)}},{key:"removeMembers",value:function(e,n,t,r,i,o,a){var u=e.dice(y({},i,t)),s=n.getDimensionTreeByDimension(i).getTreeValue();u.getCells().length||s.removeMember(t)}},{key:"travers",value:function(e,n){var l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){};e.forEach(function(c){n.tracePreOrder(function(e,n){var t,r,i,o,a,u,s;r=c,i=(t=e).dimension,o=t.members,a=t.foreignKey,u=r[a],s=o.find(function(e){return t.getMemberPrimaryKey(e)===u}),l.forEach(function(e){e(s,o,i,r,a,t)})})})}},{key:"destroyDimensionTree",value:function(e,n,t,r){k.travers(e,t,[k.removeMembers.bind(this,r,t),k.restoreCell])}}]),k}(),w=function(){function y(e){var n=this,t=e.dimension,r=e.foreignKey,i=void 0===r?y.genericId(t):r,o=e.primaryKey,a=void 0===o?"id":o,u=e.keyProps,s=e.otherProps,c=void 0===s?[]:s,l=e.members,f=void 0===l?[]:l,h=e.defaultMemberOptions,m=void 0===h?{}:h;if(v(this,y),!t||!u)throw Error('Bad definition DimensionTable, params "dimension" and "keyProps" is required');if(-1!==Object.keys(m).indexOf(a))throw Error('Bad definition DimensionTable, "defaultMemberOptions" must not contain a "primaryKey" property');this.dimension=t,this.foreignKey=i,this.primaryKey=a,this.keyProps=[].concat(u),this.otherProps=[].concat(c),this.members=f.map(function(e){return new O(e,n.primaryKey)}),this.defaultMemberOptions=d({},m)}return n(y,[{key:"setMemberList",value:function(e){[].splice.apply(this.members,[0,this.members.length].concat(e))}},{key:"clearMemberList",value:function(){this.members=[]}},{key:"getMemberPrimaryKey",value:function(e){return e[this.primaryKey]}},{key:"getMemberForeignKey",value:function(e){return e[this.foreignKey]}},{key:"addMember",value:function(e){-1===this.members.indexOf(e)?this.members.push(e):console.log("boo")}},{key:"createMember",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0,t=d({},this.defaultMemberOptions,e),r=this.keyProps,i=this.otherProps,o=this.members,a=this.primaryKey,u=r.concat(n).concat(i),s=y.reduceId(o,a),c=k.createInputMember(s,u,t,a);return this.addMember(c),c}},{key:"setMemberId",value:function(e,n){e[this.primaryKey]=n}},{key:"deleteMemberId",value:function(e){delete e[this.primaryKey]}},{key:"removeMember",value:function(e){var n=this.members.indexOf(e);if(-1===n)throw new Error("represented member was not found",e);this.members.splice(n,1)}}],[{key:"reduceId",value:function(e,t){return e.length?e.reduce(function(e,n){return e[t]>n[t]?e:n},0)[t]+1:1}},{key:"genericId",value:function(e){return"%s_id".replace("%s",e)}},{key:"createDimensionTable",value:function(e){return new y(e)}}]),y}(),M=function(){function e(){v(this,e)}return n(e,[{key:"getTreeValue",value:function(){throw"abstract method"}},{key:"getParentTree",value:function(){throw"abstract method"}},{key:"getChildTrees",value:function(){throw"abstract method"}},{key:"isExternal",value:function(){return!this.getChildTrees().length}},{key:"isRoot",value:function(){return null===this.getParentTree()}},{key:"getRoot",value:function(){var t=this;return this.traceUpOrder(function(e,n){n.isRoot()&&(t=n)}),t}},{key:"traceUpOrder",value:function(e){var n=this.getParentTree();e(this.getTreeValue(),this),null!==n&&n.traceUpOrder(e)}},{key:"tracePostOrder",value:function(n){var e=this.getChildTrees(),t=this.getTreeValue();e.length&&e.forEach(function(e){e.tracePostOrder(n)}),n(t,this)}},{key:"tracePreOrder",value:function(n){var e=this.getChildTrees(),t=this.getTreeValue();n(t,this),e.length&&e.forEach(function(e){e.tracePreOrder(n)})}}]),e}(),P=function(e){function u(e){var n;v(this,u),n=l(this,s(u).call(this));var t=e.dimensionTable,r=e.level,i=void 0===r?[]:r,o=e.parentNode,a=void 0===o?null:o;return Object.defineProperties(c(c(n)),{dimensionTable:{value:w.createDimensionTable(t),editable:!1,enumerable:!0},parentNode:{value:a,enumerable:!1,editable:!1},level:{value:i.map(function(e){return new u(d({},e,{parentNode:c(c(n))}))}),enumerable:!0,editable:!1}}),n.validateDimensions(),n}return i(u,M),n(u,[{key:"validateDimensions",value:function(){var t=[];this.tracePostOrder(function(e){var n=e.dimension;if(-1!==t.indexOf(n))throw new f;t.push(n)})}},{key:"getTreeValue",value:function(){return this.dimensionTable}},{key:"getParentTree",value:function(){return this.parentNode}},{key:"getChildTrees",value:function(){return this.level}},{key:"getDimensionTreeByDimension",value:function(t){var e=this.getRoot(),r=void 0;return e.tracePostOrder(function(e,n){e.dimension===t&&(r=n)}),r}},{key:"createProjectionOntoMember",value:function(e){var n=this.cloneDimensionTreeWithoutMembers();return this.projectDrillDown(n,e),this.projectDrillUp(n,e),n}},{key:"projectDrillDown",value:function(e,n){this.projectDrill(e,n,"traceUpOrder","drillDownDimensionMembers")}},{key:"projectDrillUp",value:function(e,n){this.projectDrill(e,n,"tracePreOrder","drillUpDimensionMembers")}},{key:"projectDrill",value:function(i,o,e,a){var u,s,c=this;this[e](function(e,n){var t=e.dimension,r=n==c?[o]:s[a](u);i.getDimensionTreeByDimension(t).getTreeValue().setMemberList(r),u=r,s=n})}},{key:"cloneDimensionTreeWithoutMembers",value:function(){var e=new u(this.getRoot());return e.tracePostOrder(function(e){e.clearMemberList()}),e}},{key:"removeProjectionOntoMember",value:function(e){var n=this.cloneDimensionTreeWithoutMembers();this.projectDrillDown(n,e),this.subtractDimensionTree(n);var t={},r=n.getRoot().getTreeValue(),i=r.dimension,o=r.members;return t[i]=o,t}},{key:"subtractDimensionTree",value:function(e){var t=this,i={};e.tracePostOrder(function(e){var n=e.dimension,t=e.members;i[n]=t}),1===this.getTreeValue().members.length&&this.tracePreOrder(function(e,n){var t=e.members,r=e.dimension;i[r]=t}),Object.keys(i).forEach(function(e){var n=t.getDimensionTreeByDimension(e).getTreeValue();i[e].forEach(function(e){n.removeMember(e)})})}},{key:"unionDimensionTree",value:function(e){var t=this,r={};e.tracePostOrder(function(e){var n=e.dimension,t=e.members;r[n]=t}),Object.keys(r).forEach(function(e){var n=t.getDimensionTreeByDimension(e).getTreeValue();r[e].forEach(function(e){n.addMember(e)})})}},{key:"drillDownDimensionMembers",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.getTreeValue().members;if(this.isRoot())return e;var t=this.getParentTree().getTreeValue(),r=this.getTreeValue(),i=t.members,o=[];return e.forEach(function(n){i.forEach(function(e){r.getMemberForeignKey(e)===t.getMemberPrimaryKey(n)&&-1===o.indexOf(e)&&o.push(e)})}),o}},{key:"drillUpDimensionMembers",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.getTreeValue().members;if(this.isExternal())return e;var t=this.getChildTrees()[0].getTreeValue(),r=t.members,i=[];return e.forEach(function(n){r.forEach(function(e){t.getMemberForeignKey(n)===t.getMemberPrimaryKey(e)&&-1===i.indexOf(e)&&i.push(e)})}),i}},{key:"createMember",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=this.getTreeValue(),t=this.getChildTrees().map(function(e){return e.getTreeValue().foreignKey}),r=[];return t.forEach(function(e){r.push(e)}),n.createMember(e,r)}}],[{key:"createDimensionTree",value:function(e){return new u(e)}},{key:"createProxyDimensionTree",value:function(e){var r=e.cloneDimensionTreeWithoutMembers();return e.tracePostOrder(function(e){var n=e.dimension,t=e.members;r.getDimensionTreeByDimension(n).getTreeValue().setMemberList(t)}),r}}]),u}(),C=function(){function i(e){var n=e.dimensionTree,t=e.activeDimension,r=e.hierarchy;if(v(this,i),!r)throw Error('attribute "hierarchy" must be defined');this.dimensionTree=n instanceof P?n:P.createDimensionTree(n),this.activeDimension=t||this.dimensionTree.getTreeValue().dimension,this.hierarchy=r}return n(i,[{key:"getDimensionTree",value:function(){return this.dimensionTree}},{key:"hasDimension",value:function(e){return!!this.dimensionTree.getDimensionTreeByDimension(e)}},{key:"getActiveDimension",value:function(){return this.activeDimension}},{key:"setActiveDimension",value:function(e){this.activeDimension=e}},{key:"getHierarchy",value:function(){return this.hierarchy}}],[{key:"createDimensionHierarchy",value:function(e){return new i(e)}}]),i}(),j=function e(n){v(this,e),Object.assign(this,n)},K=function(){function t(){v(this,t)}return n(t,null,[{key:"union",value:function(){var n={};return Array.prototype.slice.call(arguments).forEach(function(e){t.add(n,e)}),n}},{key:"add",value:function(n,t){Object.keys(t).forEach(function(e){n[e]||(n[e]=[]),Array.prototype.push.apply(n[e],t[e])})}}]),t}(),x=Object.prototype.toString;function V(e){if("object"!=o(t=e)||null===t||"[object Object]"!=(null==(n=e)?void 0===n?"[object Undefined]":"[object Null]":x.call(n)))return!1;var n,t;if(null===Object.getPrototypeOf(e))return!0;for(var r=e;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}var A=function(){function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(v(this,c),!(V(e)||e instanceof c))throw TypeError("The argument must be plain object or instance of Cube");var n=e.dimensionHierarchies,t=void 0===n?[]:n,r=e.cellTable,i=void 0===r?[]:r,o=e.defaultFactOptions,a=void 0===o?{}:o,u=e.factPrimaryKey,s=void 0===u?"id":u;this.defaultFactOptions=a,this.factPrimaryKey=s,this.dimensionHierarchies=t.map(function(e){return e.hierarchy?e instanceof C?e:C.createDimensionHierarchy(e):e.dimensionTable?e instanceof P?e:P.createDimensionTree(e):e instanceof w?e:w.createDimensionTable(e)}),this.cellTable=i.map(function(e){return e instanceof T?e:E.isEmptyCell(e)?new E(e):new T(e)})}return n(c,[{key:"slice",value:function(e,n){return this.dice(y({},e,n))}},{key:"dice",value:function(a){var u=this;if(!(V(a)||a instanceof j))throw TypeError("The argument must be a plain object");var s={};Object.keys(a).forEach(function(e){var n,r,i,o,t=a[e];n=t,t=Array.isArray(n)?n:[n],r=t,i=H.call(u,e).getTreeValue(),o=i.members,r.forEach(function(n,e){var t=o.find(function(e){return i.getMemberPrimaryKey(e)===i.getMemberPrimaryKey(n)});if(!t)throw RangeError("Not found member by id ".concat(i.getMemberPrimaryKey(t)));r instanceof O||(r[e]=t)}),t=r,s[e]=t});var e=Object.keys(s),n=this.dimensionHierarchies.length;if(e.length>n)throw Error("Set must have a size not more than ".concat(n," dimensions"));var c=[],t=e.map(function(i){var o,e=s[i].map(function(e){var n=H.call(u,i),t=n.cloneDimensionTreeWithoutMembers();n.projectDrillDown(t,e),n.projectDrillUp(t,e),o?o.unionDimensionTree(t):o=t;var r=o.getRoot().getTreeValue();return y({},r.dimension,r.members)});return o&&c.push(o),K.union.apply(K,m(e))}),l=this.getCells(),f=function(o,a){return!Object.keys(a).some(function(e){var n=a[e],t=H.call(u,e).getTreeValue(),r=t.foreignKey,i=t.primaryKey;return!n.find(function(e){return e[i]===o[r]})})};t.forEach(function(n){l=l.filter(function(e){return f(e,n)})});var h=[];return this.dimensionHierarchies.forEach(function(n){var t=!1;if(c.forEach(function(e){n.getTreeValue().dimension===e.getTreeValue().dimension&&(h.push(e),t=!0)}),!t){var e=n.getTreeValue(),r=e.members,i=e.dimension,o=P.createProxyDimensionTree(n);r.forEach(function(n){var t=!1;(l.forEach(function(e){f(e,y({},i,[n]))&&(t=!0)}),t)||-1!==o.getTreeValue().members.indexOf(n)&&o.removeProjectionOntoMember(n)}),h.push(o)}}),new B({cellTable:l,dimensionHierarchies:h,originalCube:this.originalCube||this,previousCube:this})}},{key:"drillUp",value:function(e,n){var t=I.call(this,e);return t&&t.hasDimension(n)&&t.setActiveDimension(n),this}},{key:"drillDown",value:function(e,n){var t=I.call(this,e);return t&&t.hasDimension(n)&&t.setActiveDimension(n),this}},{key:"getFacts",value:function(){return function(){var t=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.getCells(),e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=k.denormalize(r,F.call(this));e&&n.forEach(function(e,n){r[n]instanceof E&&delete e[t.factPrimaryKey]});return n}.call(this,this.getCells())}},{key:"addFacts",value:function(e){if(!Array.isArray(e))throw TypeError("The argument must be instance of Array");e.forEach(function(e,n){if(!n.hasOwnProperty(e))throw new u(e)}.bind(null,this.factPrimaryKey));var n=e.map(function(e){return new T(e)});[].push.apply(this.getCells(),n);var t=this.getFacts();return k.anotherBuild(t,n,F.call(this),this.getCells(),this.factPrimaryKey),this}},{key:"removeFacts",value:function(e){if(!Array.isArray(e))throw TypeError("The argument must be instance of Array");var t=this.getCells(),r=this.factPrimaryKey,n=e.map(function(n){return t.find(function(e){return e[r]===n[r]})});this.removeCells(n)}},{key:"getCells",value:function(){return this.cellTable}},{key:"removeCells",value:function(e){if(!Array.isArray(e))throw TypeError("The argument must be instance of Array");e.forEach(function(e){if(!(e instanceof T))throw TypeError("The list of cells must contain only instances of Cell and EmptyCell")}),k.destroy(this.getCells(),e,this.dimensionHierarchies,this)}},{key:"getDimensionMembers",value:function(e){if("string"!=typeof e)throw TypeError("The first argument must be string");return H.call(this,e).getTreeValue().members}},{key:"addDimensionMember",value:function(e){var o=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},u=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},t=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};if("string"!=typeof e)throw TypeError("The first argument must be instance of string");if(!(V(n)&&V(a)&&V(u)&&V(t)))throw TypeError("The arguments after the first must be plain objects");Object.keys(a).forEach(function(e){var n=a[e],t=o.getDimensionMembers(e),r=H.call(o,e).getTreeValue(),i=n[r.primaryKey];if(!t.find(function(e){return i===r.getMemberPrimaryKey(e)}))throw new p(e,i)});var s=H.call(this,e),r=s.getChildTrees(),c=s.getTreeValue(),i=c.foreignKey,l={};r.forEach(function(e){var n=e.getTreeValue(),t=n.dimension,r=n.foreignKey,i=n.primaryKey,o=a[t];if(!o)throw new p(t);l[r]=o[i]});var f=Object.assign({},n,l),h=s.createMember(f),m=i;s.traceUpOrder(function(e,n){if(s!==n){var t=e.dimension,r=e.foreignKey,i=y({},m,c.getMemberPrimaryKey(h));Object.assign(i,u[t]),h=n.createMember(i),m=r}}),this.fillEmptyCells(t)}},{key:"removeDimensionMember",value:function(e,n){if("string"!=typeof e)throw TypeError("The first argument must be instance of string");if(!(n instanceof O))throw TypeError("The second argument must be instance of Member");var a=H.call(this,e),u=a.removeProjectionOntoMember(n),s=this.getCells();Object.keys(u).map(function(e){var n,t,r,i,o;(t=u[n=e],r=[],i=a.getDimensionTreeByDimension(n).getTreeValue(),o=i.foreignKey,s.forEach(function(n){t.forEach(function(e){n[o]==i.getMemberPrimaryKey(e)&&r.push(n)})}),r).forEach(function(e){var n=s.indexOf(e);-1!==n&&s.splice(n,1)})})}},{key:"addDimensionHierarchy",value:function(e){var n=P.createDimensionTree(e);this.dimensionHierarchies.push(n),k.anotherBuildOne(n,this.getCells(),this.getCells(),this.getCells(),this.factPrimaryKey)}},{key:"removeDimensionHierarchy",value:function(e){if(!(e instanceof P))throw TypeError("The argument must be instance of DimensionTree");k.destroyDimensionTree(this.getCells(),this.getCells(),e,this),this.dimensionHierarchies.splice(this.dimensionHierarchies.indexOf(e),1)}},{key:"createEmptyCells",value:function(){var o=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!V(t))throw TypeError("Cell option argument must be a pure object");var a=[];return c.cartesian(this).forEach(function(r){if(!o.dice(r).getCells().length){var i={};Object.keys(r).forEach(function(e){var n=H.call(o,e).getTreeValue(),t=n.foreignKey;i[t]=n.getMemberPrimaryKey(r[e])});var e=d({},o.defaultFactOptions,t,i),n=E.createEmptyCell(e);a.push(n)}}),a}},{key:"getEmptyCells",value:function(){return this.getCells().filter(function(e){return E.isEmptyCell(e)})}},{key:"isEmptyCell",value:function(e){return E.isEmptyCell(e)}},{key:"addEmptyCells",value:function(e){var t=this;if(!Array.isArray(e))throw TypeError("The argument must be instance of Array");e.forEach(function(e,n){if(!t.isEmptyCell(e))throw TypeError("Some item in list of argument is not instances of EmptyCell, index: ".concat(n))}),[].push.apply(this.getCells(),e)}},{key:"fillEmptyCells",value:function(e){if(!(t=this,r=A.cartesian(t),i=[],r.forEach(function(e){1<t.dice(e).getFacts().length&&i.push(e)}),i).length){var n=this.createEmptyCells(e);this.addEmptyCells(n)}var t,r,i}},{key:"isSubCube",value:function(){return this instanceof B}}],[{key:"cartesian",value:function(e){if(!(e instanceof c))throw TypeError("The argument must be instance of Cube");var n=function e(n,t){for(var r=arguments.length,i=new Array(2<r?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return t?e.apply(void 0,[(a=n,u=t,(s=[]).concat.apply(s,m(a.map(function(n){return u.map(function(e){return[].concat(n,e)})}))))].concat(i)):n;var a,u,s},i=[],t=e.dimensionHierarchies.map(function(e){return e.getTreeValue()}).map(function(e){return i.push(e.dimension),e.members}),o=[];return t.length&&(1<t.length?n.apply(null,t):t[0].map(function(e){return[e]})).forEach(function(t){var r={};return i.forEach(function(e,n){r[e]=t[n]}),o.push(new j(r)),r}),o}}]),c}(),B=function(e){function o(e){var n,t=e.originalCube,r=e.previousCube,i=a(e,["originalCube","previousCube"]);return v(this,o),(n=l(this,s(o).call(this,i))).originalCube=t,n.previousCube=r,n}return i(o,A),o}();function I(n){return this.dimensionHierarchies.find(function(e){return e.getHierarchy()===n})}function H(n){var t;if(this.dimensionHierarchies.forEach(function(e){e.getDimensionTreeByDimension(n)&&(t=e.getDimensionTreeByDimension(n))}),!t)throw RangeError("Not existed dimension: ".concat(n));return t}function F(){return this.dimensionHierarchies.map(function(e){return e.getDimensionTree?e.getDimensionTree():e})}return A});
//# sourceMappingURL=cube.min.js.map
